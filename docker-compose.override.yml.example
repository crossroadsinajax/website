version: '3.7'

# Override the default docker-compose.yml with dev settings
services:
  app:
    command: ddtrace-run python manage.py runserver 0.0.0.0:8000
    environment:
      - DD_ENV=dev
      - POSTMARK_API_KEY=
    volumes:
      - .:/app

  web:
    build:
      context: .
      dockerfile: ./docker/web/Dockerfile
    # Note that we want to match this port with the
    # port used by nginx so that the JS that the
    # webpack dev server sends to the browser will
    # be proxied through nginx.
    # Else we get a CORS error.
    command: yarn run webpack-dev-server --host 0.0.0.0 --port 8000 --hot
    volumes:
      - ./web:/app

  nginx:
    build:
      context: ./docker/nginx_dev
      dockerfile: ./Dockerfile
    # Edit 8000 to your desired port
    ports:
      - 8000:80

  datadog:
    environment:
      - DD_API_KEY=
